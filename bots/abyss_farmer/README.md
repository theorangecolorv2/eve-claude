# Abyss Farmer Bot

Бот для автоматического фарма абиссов в EVE Online.

## Статус

✅ **Базовый функционал готов** - вход в абисс и прохождение комнаты реализованы.

## Возможности

- ✅ Автоматический вход в абисс через филамент
- ✅ Прохождение комнаты (контейнер)
- ✅ Управление МВД и дронами
- ✅ Атака контейнера
- ⚠️ Лут врека (базовая реализация)
- ❌ Выход из абисса (TODO)
- ❌ Прохождение нескольких комнат (TODO)

## Структура модулей

```
bots/abyss_farmer/
├── main.py          # Главный файл бота
├── enter.py         # Вход в абисс (использование филамента)
├── room.py          # Прохождение комнаты (высокоуровневая логика)
├── cache.py         # Работа с контейнером (переиспользуемый компонент)
├── config.json      # Конфигурация бота
└── README.md        # Документация
```

### Модули

**`main.py`** - Главный цикл бота
- Запуск Sanderling
- Цикл забегов
- Интеграция всех модулей

**`enter.py`** - Вход в абисс
- Открытие инвентаря
- Активация фильтра
- Использование филамента

**`room.py`** - Прохождение комнаты
- Ожидание появления контейнера
- Вызов обработки контейнера
- Высокоуровневая логика

**`cache.py`** - Работа с контейнером (переиспользуемый)
- Аппроч к контейнеру
- Включение МВД
- Выпуск дронов
- Лок и атака
- Ожидание смерти
- Лут врека

## Использование

### Запуск бота

```bash
python bots/abyss_farmer/main.py
```

### Тестирование отдельных функций

```bash
# Тест входа в абисс
python scripts/test_abyss_enter.py

# Тест обработки контейнера
python scripts/test_abyss_cache.py

# Тест прохождения комнаты (полный цикл)
python scripts/test_abyss_room.py
```

## Конфигурация

Настройки бота находятся в `config.json`:

```json
{
  "filament_type": "calm_exotic",
  "max_runs": 10,
  "loot_all": true
}
```

## Требования

- EVE Online запущен
- Корабль подготовлен для абиссов (ракеты, МВД, дроны)
- Филаменты в инвентаре
- Фильтр `!FILAMENT!` настроен в инвентаре
- Sanderling работает корректно

## Алгоритм прохождения комнаты

1. Ждать появления "Triglavian Bioadaptive Cache" в overview
2. Выбрать контейнер и аппрочить
3. Включить МВД (кнопка 2) если выключен
4. Выпустить дронов (Shift+F)
5. При расстоянии ≤30km:
   - Залочить контейнер (Ctrl+Click)
   - Активировать ракеты (кнопка 1)
   - Отправить дронов (F)
6. Ждать смерти контейнера
7. Залутать врек

## TODO

- [ ] Выход из абисса через гейт
- [ ] Прохождение нескольких комнат подряд
- [ ] Улучшенный лут (кнопка "Loot All")
- [ ] Обработка разных типов комнат
- [ ] Управление щитами/репом
- [ ] Статистика забегов

## Использование модуля cache (переиспользуемый компонент)

Модуль `cache.py` можно использовать отдельно для обработки контейнеров:

```python
from core.sanderling.service import SanderlingService
from bots.abyss_farmer.cache import process_cache

sanderling = SanderlingService()
sanderling.start()

# Обработать контейнер с кастомными параметрами
success = process_cache(
    sanderling,
    approach_timeout=120.0,      # Таймаут приближения
    kill_timeout=60.0,           # Таймаут убийства
    attack_distance_km=30.0,     # Дистанция атаки
    enable_mwd=True,             # Включить МВД
    launch_drones=True           # Выпустить дронов
)
```

### Функции модуля cache

- `process_cache()` - Полный цикл обработки контейнера
- `find_cache()` - Найти контейнер в overview
- `approach_cache()` - Аппрочить контейнер
- `ensure_mwd_active()` - Включить МВД
- `launch_drones_safe()` - Выпустить дронов (безопасно)
- `wait_and_attack()` - Ждать приближения и атаковать
- `wait_cache_death()` - Ждать смерти контейнера
- `loot_wreck()` - Залутать врек

## Roadmap

### Фаза 1: Базовая функциональность ✅
- ✅ Вход в абисс
- ✅ Прохождение одной комнаты
- ✅ Базовый лут

### Фаза 2: Навигация (в работе)
- [ ] Выход из абисса через гейт
- [ ] Переход между комнатами
- [ ] Детекция типа комнаты

### Фаза 3: Оптимизация
- [ ] Улучшенный лут
- [ ] Управление щитами
- [ ] Статистика забегов

### Фаза 4: Интеграция
- [ ] Telegram уведомления
- [ ] Автоматический запуск
- [ ] Обработка ошибок
